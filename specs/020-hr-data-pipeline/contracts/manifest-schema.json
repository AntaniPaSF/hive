{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Data Manifest Schema",
  "description": "Tracks all ingested documents for version control and reproducibility",
  "type": "object",
  "required": [
    "manifest_version",
    "generated_at",
    "total_documents",
    "total_chunks",
    "total_size_bytes",
    "documents",
    "configuration"
  ],
  "properties": {
    "manifest_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of manifest format",
      "examples": ["1.0.0"]
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Manifest generation timestamp (ISO 8601)"
    },
    "total_documents": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of ingested documents"
    },
    "total_chunks": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of chunks across all documents"
    },
    "total_size_bytes": {
      "type": "integer",
      "minimum": 0,
      "description": "Total size of data directory in bytes"
    },
    "documents": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/document_entry"
      },
      "description": "List of all ingested documents"
    },
    "configuration": {
      "$ref": "#/definitions/configuration"
    }
  },
  "definitions": {
    "document_entry": {
      "type": "object",
      "required": [
        "document_id",
        "filename",
        "source_type",
        "file_path",
        "checksum",
        "ingestion_timestamp",
        "chunk_count",
        "related_topics",
        "validation_results"
      ],
      "properties": {
        "document_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for document"
        },
        "filename": {
          "type": "string",
          "maxLength": 255,
          "description": "Original filename"
        },
        "source_type": {
          "type": "string",
          "enum": ["pdf", "kaggle", "huggingface"],
          "description": "Document source"
        },
        "file_path": {
          "type": "string",
          "pattern": "^data/",
          "description": "Relative path from repository root"
        },
        "checksum": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 hash of document"
        },
        "ingestion_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When document was ingested (ISO 8601)"
        },
        "chunk_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of chunks created from document"
        },
        "related_topics": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "PDF topics this document relates to (empty for PDF source)"
        },
        "validation_results": {
          "type": "object",
          "required": ["contradictions_excluded", "duplicates_skipped"],
          "properties": {
            "contradictions_excluded": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of chunks excluded due to contradictions"
            },
            "duplicates_skipped": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of chunks skipped due to duplication"
            }
          }
        }
      }
    },
    "configuration": {
      "type": "object",
      "required": [
        "embedding_model",
        "chunk_size",
        "chunk_overlap",
        "similarity_threshold_relevance",
        "similarity_threshold_duplicate",
        "vector_db_type",
        "vector_db_path"
      ],
      "properties": {
        "embedding_model": {
          "type": "string",
          "description": "sentence-transformers model name",
          "examples": ["all-MiniLM-L6-v2"]
        },
        "chunk_size": {
          "type": "integer",
          "minimum": 100,
          "maximum": 2048,
          "description": "Maximum tokens per chunk"
        },
        "chunk_overlap": {
          "type": "integer",
          "minimum": 0,
          "maximum": 512,
          "description": "Overlap tokens between chunks"
        },
        "similarity_threshold_relevance": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Minimum similarity for external data relevance"
        },
        "similarity_threshold_duplicate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Maximum similarity before marking as duplicate"
        },
        "vector_db_type": {
          "type": "string",
          "enum": ["chromadb"],
          "description": "Vector database implementation"
        },
        "vector_db_path": {
          "type": "string",
          "description": "Vector database persistence path"
        }
      }
    }
  },
  "examples": [
    {
      "manifest_version": "1.0.0",
      "generated_at": "2026-01-21T10:45:00Z",
      "total_documents": 2,
      "total_chunks": 1200,
      "total_size_bytes": 52428800,
      "documents": [
        {
          "document_id": "550e8400-e29b-41d4-a716-446655440000",
          "filename": "Software_Company_Docupedia_FILLED.pdf",
          "source_type": "pdf",
          "file_path": "data/pdf/Software_Company_Docupedia_FILLED.pdf",
          "checksum": "a3b2c1d4e5f6789abcdef0123456789abcdef0123456789abcdef0123456789a",
          "ingestion_timestamp": "2026-01-21T10:30:00Z",
          "chunk_count": 1050,
          "related_topics": [],
          "validation_results": {
            "contradictions_excluded": 0,
            "duplicates_skipped": 0
          }
        },
        {
          "document_id": "650e8400-e29b-41d4-a716-446655440003",
          "filename": "hr-benefits-guide.json",
          "source_type": "kaggle",
          "file_path": "data/kaggle/hr-benefits-guide.json",
          "checksum": "b4c3d2e1f0a9876543210fedcba9876543210fedcba9876543210fedcba9876",
          "ingestion_timestamp": "2026-01-21T10:40:00Z",
          "chunk_count": 150,
          "related_topics": ["vacation policy", "healthcare benefits"],
          "validation_results": {
            "contradictions_excluded": 3,
            "duplicates_skipped": 12
          }
        }
      ],
      "configuration": {
        "embedding_model": "all-MiniLM-L6-v2",
        "chunk_size": 512,
        "chunk_overlap": 50,
        "similarity_threshold_relevance": 0.75,
        "similarity_threshold_duplicate": 0.85,
        "vector_db_type": "chromadb",
        "vector_db_path": "/app/vectordb_storage"
      }
    }
  ]
}
